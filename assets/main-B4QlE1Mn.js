import"./modulepreload-polyfill-B5Qt9EMX.js";const y={LOGO_URL:"/logo.webp",PATTERN_URL:"/pattern.svg",WHATSAPP_PHONE:"201551846461",CALL_PHONE:"01060682224"},k={CART:"tant_koki_cart_v1",INSTALL_DISMISS:"tkk_install_prompt_dismissed_v1"},M={PRODUCTS_JSON:"/data/products.json",PRODUCTS_API:"/api/products"},a=t=>document.getElementById(t),H=(t,e=document)=>Array.from(e.querySelectorAll(t)),m={currentCategory:"",activeTab:"all",activeMaxPrice:0,activeSort:"default"};async function rt(){const t=[M.PRODUCTS_API,M.PRODUCTS_JSON];let e=null;for(const r of t)try{const s=await fetch(r,{credentials:"same-origin"});if(!s.ok)throw new Error(`${s.status} ${s.statusText}`);const n=await s.json();if(Array.isArray(n))return n}catch(s){e=s}throw new Error(`Failed to load products from API/JSON. Last error: ${e?.message||e}`)}const G=t=>[...new Set(t)].filter(Boolean),it=t=>{const e=(t??"").toString().trim().toLowerCase();return e==="true"||e==="1"||e==="yes"||e==="y"};function v(t){return t==null||Number.isNaN(Number(t))?"":new Intl.NumberFormat("ar-EG",{maximumFractionDigits:2}).format(Number(t))+" Ø¬.Ù…"}function l(t){return(t??"").replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[e])}const u=t=>t.sale_price&&t.price&&t.sale_price<t.price,q=t=>it(t.by_weight),z=t=>q(t)?.25:1;function at(t){const e=(t||"").toString().toLowerCase();return e.includes("Ù„Ø­Ù…")||e.includes("Ù„Ø­ÙˆÙ…")||e.includes("ÙƒÙ†Ø¯ÙˆØ²")||e.includes("Ø¨Ø±Ø§Ø²ÙŠÙ„ÙŠ")?"ğŸ¥©":e.includes("Ø¯ÙˆØ§Ø¬Ù†")||e.includes("ÙØ±Ø§Ø®")||e.includes("Ø¯Ø¬Ø§Ø¬")?"ğŸ—":e.includes("Ø³Ù…Ùƒ")||e.includes("Ø£Ø³Ù…Ø§Ùƒ")||e.includes("Ø¨Ø­Ø±ÙŠ")||e.includes("Ø¬Ù…Ø¨Ø±ÙŠ")?"ğŸŸ":e.includes("Ø®Ø¶Ø§Ø±")||e.includes("Ø®Ø¶Ø±ÙˆØ§Øª")?"ğŸ¥¦":e.includes("Ø²ÙŠØª")||e.includes("Ø²ÙŠÙˆØª")||e.includes("Ø³Ù…Ù†")?"ğŸ§ˆ":e.includes("Ù…ÙƒØ±ÙˆÙ†Ø©")||e.includes("Ù…ÙƒØ±ÙˆÙ†Ø§Øª")||e.includes("Ù…Ø¹ÙƒØ±ÙˆÙ†Ø©")?"ğŸ":e.includes("ØµÙ„ØµØ©")||e.includes("ÙƒØ§ØªØ´Ø¨")||e.includes("Ø·Ù…Ø§Ø·Ù…")?"ğŸ…":e.includes("Ø¹Ø³Ù„")?"ğŸ¯":e.includes("Ø¨ÙŠØ¶")?"ğŸ¥š":e.includes("Ø±Ù‚Ø§Ù‚ Ùˆ Ø¬Ù„Ø§Ø´")?"ğŸ¥Ÿ":e.includes("Ø·Ù†Ø· ÙƒÙˆÙƒÙŠ")?"Ø·Ù†Ø· ÙƒÙˆÙƒÙŠ":e.includes("ØµÙˆØµØ§Øª")||e.includes("ØµÙˆØµ")?"ğŸ§´":e.includes("Ø¬Ø¨Ù†")||e.includes("Ø¬Ø¨Ù†Ø©")?"ğŸ§€":e.includes("Ù…Ø¬Ù…Ø¯Ø§Øª")||e.includes("ÙØ±ÙˆØ²Ù†")?"â„ï¸":e.includes("Ø£ØµÙ†Ø§Ù")||e.includes("Ù…Ù†ÙˆØ¹")||e.includes("Ø§Ø®Ø±Ù‰")||e.includes("Ø£Ø®Ø±Ù‰")?"ğŸ“¦":"ğŸ›’"}function ct(){const t=new Date,e=r=>String(r).padStart(2,"0");return`TKK-${t.getFullYear()}${e(t.getMonth()+1)}${e(t.getDate())}-${e(t.getHours())}${e(t.getMinutes())}${e(t.getSeconds())}`}const f=new Map,J=t=>t?._uid||t?.id||t?.name;function I(t){document.dispatchEvent(new CustomEvent("cart:change",{detail:t}))}function g(){return f}function ot(){let t=0,e=0;for(const{qty:r,p:s}of f.values()){t+=r;const n=u(s)?s.sale_price:s.price;e+=(n||0)*r}return{itemsCount:f.size,qtyTotal:t,total:e}}function O(){const t=Array.from(f.entries());localStorage.setItem(k.CART,JSON.stringify(t))}function lt(){try{const t=localStorage.getItem(k.CART);if(!t)return;JSON.parse(t).forEach(([r,s])=>f.set(r,s)),I({action:"load"})}catch(t){console.error("Error loading cart",t)}}function dt(){f.clear(),O(),I({action:"clear"})}function x(t){const e=J(t);if(!e)return;const r=z(t),s=f.get(e)||{qty:0};s.qty=+(s.qty+r).toFixed(2),f.set(e,{qty:s.qty,p:t}),O(),I({action:"add",key:e})}function K(t){const e=J(t);if(!e)return;const r=z(t),s=f.get(e);s&&(s.qty=+(s.qty-r).toFixed(2),s.qty<=0?f.delete(e):f.set(e,s),O(),I({action:"dec",key:e}))}function ut(t,e){const r=G(t.map(i=>i.category)),s=a("tabsContainer");if(!s)return;const n=["Ø¹Ø±ÙˆØ¶","ØªÙˆÙÙŠØ±","Ø¨ÙˆÙƒØ³","Ø¹Ø±Ø¶","Ø·Ù†Ø· ÙƒÙˆÙƒÙŠ"],c=[],o=[];r.forEach(i=>{n.some(p=>(i||"").includes(p))?c.push(i):o.push(i)});let d='<button class="tab-btn active" data-tab="all">Ø§Ù„ÙƒÙ„</button>';c.forEach(i=>{d+=`<button class="tab-btn" style="color:#d40000;border-color:#ffcccc;background:#fff5f5" data-tab="${l(i)}">âš¡ ${l(i)}</button>`}),o.sort().forEach(i=>{d+=`<button class="tab-btn" data-tab="${l(i)}">${l(i)}</button>`}),s.innerHTML=d,s.querySelectorAll(".tab-btn").forEach(i=>{i.addEventListener("click",()=>{s.querySelectorAll(".tab-btn").forEach(p=>p.classList.remove("active")),i.classList.add("active"),e?.(i.getAttribute("data-tab")||"all")})})}function ft(t,e){const r=G(t.map(n=>n.category)),s=a("catsView");s&&(s.innerHTML=r.map(n=>{const c=at(n);return c==="Ø·Ù†Ø· ÙƒÙˆÙƒÙŠ"?`<button class="cat-card" data-reveal data-cat="${l(n)}">
          <div style="color:#d40000;display:flex;justify-content:center;align-items:center;" class="cat-title">
            ${l(n)} <img style="height:35px;margin-right:10px;" src="/logo.webp" alt="Ø·Ù†Ø· ÙƒÙˆÙƒÙŠ">
          </div>
        </button>`:`<button class="cat-card" data-reveal data-cat="${l(n)}">
        <div class="cat-emoji">${c}</div>
        <div class="cat-title">${l(n)}</div>
      </button>`}).join(""),s.querySelectorAll(".cat-card").forEach(n=>{n.addEventListener("click",()=>e?.(n.getAttribute("data-cat")||""))}))}function mt(t,{onAdd:e,onInc:r,onDec:s,onAfterRender:n}={}){const c=a("grid"),o=a("empty");if(!c||!o)return;const d=new Map(t.map(i=>[i._uid,i]));if(!t.length){c.innerHTML="",o.style.display="block",n?.();return}o.style.display="none",c.innerHTML=t.map(i=>{const p=i.in_stock?u(i)?'<div class="badge offer">Ø¹Ø±Ø¶</div>':i.is_new?'<div class="badge new">Ø¬Ø¯ÙŠØ¯</div>':"":'<div class="badge oos">Ù†ÙØ¯Øª</div>',h=u(i)?`<span class="price">${v(i.sale_price)}</span><span class="old">${v(i.price)}</span>`:`<span class="price">${v(i.price)}</span>`,b=q(i)?"Ù„ÙƒÙ„ ÙƒØ¬Ù…":(i.unit||"").trim()?`Ù„ÙƒÙ„ ${l(i.unit)}`:"",E=b?`<div class="unitNote">${b}</div>`:"",Z=i.company?`<span class="brandTag">${l(i.company)}</span>`:"",tt=i.image_url?`<img loading="lazy" src="${l(i.image_url)}" alt="${l(i.name)}">`:"",N=(i.description||"").trim(),et=N?`<div class="desc">${l(N)}</div>`:'<div class="desc desc-muted">Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¶Ù…ÙˆÙ† Ù…Ù† Ø·Ù†Ø· ÙƒÙˆÙƒÙŠ.</div>',nt=i.updated_at?`<div class="meta-line">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${l(i.updated_at)}</div>`:"",st=i.in_stock?"":"disabled";return`<article class="card" data-reveal data-id="${l(i._uid)}" data-by-weight="${i.by_weight?"1":"0"}">
      <img src="/logo-badge.png" class="logo-badge" loading="lazy" alt="">
      <div class="plate">${p}${tt}</div>
      <div class="name">${l(i.name||"")}</div>
      ${et}
      <div class="row">
        <div>${h}${E}</div>
        <div>${Z}</div>
      </div>
      ${nt}
      <div class="choose">
        <button class="add" ${st}>Ø£Ø¶Ù</button>
        <div class="stepper">
          <button class="step" data-act="dec">â€“</button>
          <div class="qty">1</div>
          <button class="step" data-act="inc">+</button>
        </div>
      </div>
    </article>`}).join(""),c.querySelectorAll(".card").forEach(i=>{const p=i.getAttribute("data-id"),h=d.get(p);h&&(i.querySelector(".add")?.addEventListener("click",()=>h.in_stock&&e?.(h)),i.querySelectorAll(".step").forEach(b=>{b.addEventListener("click",()=>{const E=b.getAttribute("data-act");E==="inc"&&r?.(h),E==="dec"&&s?.(h)})}))}),n?.()}function D(){a("catsView")?.classList.add("hidden"),a("productsView")?.classList.remove("hidden"),document.body.classList.add("products-mode")}function A(){a("productsView")?.classList.add("hidden"),a("catsView")?.classList.remove("hidden"),document.body.classList.remove("products-mode")}function vt(t,e){const r=(a("q")?.value||"").toLowerCase().trim();let s=t.filter(n=>{if(e.activeTab!=="all"&&e.activeTab!==""&&n.category!==e.activeTab)return!1;const c=u(n)?n.sale_price:n.price;if(e.activeMaxPrice>0&&c>e.activeMaxPrice)return!1;const o=Array.isArray(n.tags)?n.tags.join(" "):n.tags||"",d=`${n.name||""} ${n.description||""} ${o} ${n.company||""}`.toLowerCase();return!(r&&!d.includes(r))});return s.sort((n,c)=>{if(n.in_stock!==c.in_stock)return n.in_stock?-1:1;if(e.activeSort==="priceAsc"){const o=u(n)?n.sale_price:n.price,d=u(c)?c.sale_price:c.price;return(o??0)-(d??0)}return u(n)!==u(c)?u(n)?-1:1:n.is_featured!==c.is_featured?n.is_featured?-1:1:(n.name||"").localeCompare(c.name||"","ar")}),s}function pt(t){a("q")?.addEventListener("input",()=>t?.())}function ht(t,e){H(".qf-btn").forEach(r=>{r.addEventListener("click",()=>{const s=Number(r.dataset.max||0),n=r.dataset.sort;r.classList.contains("active")?(r.classList.remove("active"),s&&(t.activeMaxPrice=0),n&&(t.activeSort="default")):(H(".qf-btn").forEach(c=>c.classList.remove("active")),r.classList.add("active"),s&&(t.activeMaxPrice=s),n&&(t.activeSort=n)),e?.()})})}let w=null;function Q(){const t=a("orderbar");t&&(t.classList.remove("pulse"),t.offsetWidth,t.classList.add("pulse"))}function yt(t){const e=a("orderbar");e&&(t>0?w||(w=setInterval(()=>{g().size>0&&Q()},2e3)):(w&&(clearInterval(w),w=null),e.classList.remove("pulse")))}function gt({forceBounce:t=!1}={}){const{itemsCount:e,total:r}=ot(),s=a("orderbar");s&&(e>0?(s.style.display="flex",a("orderCount").textContent=`${e} ØµÙ†Ù`,a("orderTotal").textContent=`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${v(r)}`,t&&Q()):s.style.display="none",yt(e))}function Y(){const t=g();H(".card[data-id]").forEach(e=>{const r=e.getAttribute("data-id"),s=t.get(r),n=e.querySelector(".add"),c=e.querySelector(".stepper"),o=e.querySelector(".qty");if(!n||!c||!o)return;const d=e.getAttribute("data-by-weight")==="1";s?(n.style.display="none",c.classList.add("show"),o.textContent=d?s.qty.toLocaleString("ar-EG",{maximumFractionDigits:2})+" ÙƒØ¬Ù…":String(s.qty)):(n.style.display="block",c.classList.remove("show"),o.textContent=d?"0.25 ÙƒØ¬Ù…":"1")})}function bt(){const t=a("cartList");if(t){t.innerHTML="";for(const{qty:e,p:r}of g().values()){const s=u(r)?r.sale_price:r.price,n=(s||0)*e,c=q(r)?e.toLocaleString("ar-EG",{maximumFractionDigits:2})+" ÙƒØ¬Ù…":e+" Ù‚Ø·Ø¹Ø©",o=document.createElement("li");o.innerHTML=`
      <div>
        <strong>${l(r.name)}</strong>
        <div class="meta">${l(r.unit||"")} â€¢ ${s==null?"â€”":v(s)}</div>
      </div>
      <div class="cartQty">
        <button class="cartStep" data-act="dec" data-id="${l(r._uid)}">-</button>
        <span>${c} = ${v(n)}</span>
        <button class="cartStep" data-act="inc" data-id="${l(r._uid)}">+</button>
      </div>`,t.appendChild(o)}t.querySelectorAll(".cartStep").forEach(e=>{const r=e.getAttribute("data-act"),s=e.getAttribute("data-id"),n=g().get(s);n&&(e.onclick=()=>r==="inc"?x(n.p):K(n.p))})}}function wt(){const t=a("drawer");a("toggleDrawer")?.addEventListener("click",()=>t?.classList.toggle("show")),a("closeDrawer")?.addEventListener("click",()=>t?.classList.remove("show"))}function Lt(t){const r=[`Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ (#${ct()})`];let s=0;for(const{qty:n,p:c}of g().values()){const o=u(c)?c.sale_price:c.price,d=(o||0)*n;s+=d;const i=q(c)?`${n.toLocaleString("ar-EG",{maximumFractionDigits:2})} ÙƒØ¬Ù…`:`${n} Ù‚Ø·Ø¹Ø©`;r.push(`â€¢ ${i} Ù…Ù† ${c.name} ${c.unit?"("+c.unit+")":""} â€” ${o==null?"â€”":v(o)} | ${v(d)}`)}return r.push(`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${v(s)}`),r.push("Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ â¤ï¸"),t&&(r.push(""),r.push(`Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„: ${t.phone}`),r.push(`Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${t.addr}`)),r.join("\\n")}function St(){const t=a("overlay");a("sendWA")?.addEventListener("click",()=>{g().size!==0&&(t?.classList.add("show"),a("custPhone")?.focus())}),a("closeModal")?.addEventListener("click",()=>t?.classList.remove("show")),a("confirmSend")?.addEventListener("click",()=>{const e=(a("custPhone")?.value||"").trim(),r=(a("custAddr")?.value||"").trim();if(!e||!r)return alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.");const s=Lt({phone:e,addr:r});window.location.href=`https://wa.me/${y.WHATSAPP_PHONE}?text=${encodeURIComponent(s)}`,t?.classList.remove("show")})}function $t({onStart:t}={}){a("heroStart")?.addEventListener("click",()=>{t?.(),a("catsView")?.scrollIntoView({behavior:"smooth",block:"start"})}),a("quickHelp")?.addEventListener("click",()=>{const e=encodeURIComponent("Ù…Ø´ ÙØ§Ø¶ÙŠØ© Ø£Ø¯ÙˆÙ‘Ø± ÙƒØªÙŠØ±ØŒ Ø³Ø§Ø¹Ø¯ÙˆÙ†ÙŠ Ø£Ø¸Ø¨Ø· Ø·Ù„Ø¨ Ù„Ø·Ø¨Ø®Ø© Ø£Ùˆ Ø¹Ø²ÙˆÙ…Ø© ğŸ™");window.open(`https://wa.me/${y.WHATSAPP_PHONE}?text=${e}`,"_blank")})}function X(){if(!("IntersectionObserver"in window))return;const t=new IntersectionObserver(e=>{e.forEach(r=>{r.isIntersecting&&(r.target.classList.add("reveal-show"),t.unobserve(r.target))})},{threshold:.12});document.querySelectorAll("[data-reveal]").forEach(e=>{e.classList.add("reveal"),t.observe(e)})}let R=!1,_=!1;function Et(){a("exitOverlay")?.classList.add("show")}function B(){a("exitOverlay")?.classList.remove("show")}function At(t){window.history&&history.pushState&&history.pushState({screen:"category",cat:t},"","")}function _t({uiState:t,onShowHome:e,onShowCategory:r}={}){R||!window.history||!history.pushState||(R=!0,history.replaceState({screen:"guard"},"",""),history.pushState({screen:"home"},"",""),a("stayOnSite")?.addEventListener("click",()=>{_=!1,B()}),a("exitSite")?.addEventListener("click",()=>{_=!0,B(),history.back()}),window.addEventListener("popstate",s=>{const n=s.state||{};if(n.screen==="guard"){if(_){_=!1,setTimeout(()=>history.back(),0);return}Et(),history.pushState({screen:"home"},"","");return}if(n.screen==="home"){t.currentCategory="",e?.();return}n.screen==="category"&&(t.currentCategory=n.cat||"",r?.(t.currentCategory))}))}let L=null;function F(){const t=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches,e=window.navigator.standalone===!0;return t||e}function U(){return/iphone|ipad|ipod/i.test(window.navigator.userAgent||"")}function j(){return localStorage.getItem(k.INSTALL_DISMISS)!=="1"}function C(){localStorage.setItem(k.INSTALL_DISMISS,"1")}function V(){a("installHint")?.classList.add("show")}function T(){a("installHint")?.classList.remove("show")}function Ct(){F()||!j()||(window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),L=t,setTimeout(V,1500)}),U()&&setTimeout(()=>{!F()&&j()&&V()},2e3),a("installLater")?.addEventListener("click",()=>{T(),C()}),a("installNow")?.addEventListener("click",async()=>{if(L){T(),L.prompt();try{await L.userChoice}finally{L=null,C()}}else U()?(alert('Ø¹Ø´Ø§Ù† ØªØ«Ø¨Ù‘ØªÙŠ Ø·Ù†Ø· ÙƒÙˆÙƒÙŠ:\\nÙ…Ù† Safari Ø¯ÙˆØ³ÙŠ Ù…Ø´Ø§Ø±ÙƒØ© â–¢â¬† Ø«Ù… "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©".'),T(),C()):(T(),C())}))}let $=[];function P(t){document.querySelectorAll(".tab-btn").forEach(e=>e.classList.remove("active")),document.querySelector(`.tab-btn[data-tab="${CSS.escape(t)}"]`)?.classList.add("active")}function S(){const t=vt($,m);mt(t,{onAdd:e=>x(e),onInc:e=>x(e),onDec:e=>K(e),onAfterRender:()=>{X(),Y()}})}function W(t){const e=t?.detail?.action;gt({forceBounce:e==="add"}),bt(),Y()}async function Tt(){if(a("logo")&&(a("logo").src=y.LOGO_URL),a("tel")&&(a("tel").href=`tel:${y.CALL_PHONE}`),a("wa")&&(a("wa").href=`https://wa.me/${y.WHATSAPP_PHONE}`),$=await rt(),!$.length){a("grid").innerHTML="<div class='empty'>Ù…ÙÙŠØ´ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>";return}ut($,t=>{m.activeTab=t,S()}),ft($,t=>{m.currentCategory=t,m.activeTab=t,D(),P(t),S(),At(t)}),wt(),St(),$t({onStart:()=>A()}),Ct(),pt(()=>S()),ht(m,()=>S()),a("clearSel")?.addEventListener("click",()=>dt()),a("backCats")?.addEventListener("click",()=>{m.currentCategory="",m.activeTab="all",A(),P("all"),history.replaceState&&history.replaceState({screen:"home"},"","")}),_t({uiState:m,onShowHome:()=>A(),onShowCategory:t=>{m.activeTab=t,D(),P(t),S()}}),A(),document.addEventListener("cart:change",W),lt(),W({detail:{action:"load"}}),X()}window.addEventListener("DOMContentLoaded",()=>{document.documentElement.style.setProperty("--pattern-url",`url('${y.PATTERN_URL}')`),Tt().catch(t=>{console.error(t),a("grid").innerHTML="<div class='empty'>Ø­ØµÙ„ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>"})});
